#!/bin/bash

# Stop script for Survey Insights development servers
# Kills processes on common development ports

echo "üõë Stopping development servers..."

# Common ports to check
PORTS=(3000 3001 5432 54321)

for PORT in "${PORTS[@]}"; do
    # Find process ID on the port
    PID=$(lsof -ti:$PORT)
    
    if [ ! -z "$PID" ]; then
        echo "   Killing process on port $PORT (PID: $PID)"
        kill -9 $PID 2>/dev/null
        
        # Verify the process was killed
        sleep 0.5
        if lsof -ti:$PORT > /dev/null 2>&1; then
            echo "   ‚ö†Ô∏è  Failed to kill process on port $PORT"
        else
            echo "   ‚úÖ Successfully stopped process on port $PORT"
        fi
    else
        echo "   ‚ÑπÔ∏è  No process found on port $PORT"
    fi
done

# Also kill any Next.js dev server processes by name
echo ""
echo "üîç Checking for Next.js processes..."
NEXT_PIDS=$(pgrep -f "next dev" | xargs)

if [ ! -z "$NEXT_PIDS" ]; then
    echo "   Killing Next.js dev processes: $NEXT_PIDS"
    pkill -9 -f "next dev" 2>/dev/null
    echo "   ‚úÖ Next.js processes stopped"
else
    echo "   ‚ÑπÔ∏è  No Next.js processes found"
fi

# Check for node processes related to this project
echo ""
echo "üîç Checking for node processes in this directory..."
PROJECT_DIR=$(pwd)
NODE_PIDS=$(ps aux | grep node | grep "$PROJECT_DIR" | grep -v grep | awk '{print $2}' | xargs)

if [ ! -z "$NODE_PIDS" ]; then
    echo "   Killing node processes: $NODE_PIDS"
    kill -9 $NODE_PIDS 2>/dev/null
    echo "   ‚úÖ Node processes stopped"
else
    echo "   ‚ÑπÔ∏è  No node processes found for this project"
fi

echo ""
echo "‚ú® Done! All development servers stopped."

